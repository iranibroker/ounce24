@if (userQuery.isLoading()) {
  <app-data-loading />
} @else if (userQuery.data()) {
  <mat-toolbar>
    <mat-toolbar-row>
      @if (isOwnProfile()) {
        <button mat-button>
          <i class="fa-solid fa-gem fa-lg"></i>
          {{ 'profile.yourGems' | translate }}:
          {{ userQuery.data()?.gem || 0 | number }}
        </button>
        <span class="spacer"></span>
        <button mat-stroked-button routerLink="/profile/edit">
          <i class="fa-regular fa-edit"></i>
          {{ 'profile.edit.pageTitle' | translate }}
        </button>
      } @else {
        <button mat-icon-button goBack>
          <i class="fa-solid fa-chevron-left fa-xs rtl"></i>
        </button>
      }
    </mat-toolbar-row>
    <mat-toolbar-row>
      <img
        [appAvatar]="userQuery.data()"
        [alt]="userQuery.data().title || userQuery.data().name"
        class="toolbar-avatar"
      />
      <h1 class="toolbar-title">
        {{ userQuery.data().title || userQuery.data().name }}
      </h1>
    </mat-toolbar-row>
  </mat-toolbar>
  <div class="profile-container">
    <mat-card class="user-info-card">
      <mat-card-content>
        <div class="stats-grid">
          <div class="stat-item">
            <i class="fas fa-wave-square"></i>
            <span>{{ 'profile.signals' | translate }}</span>
            <strong>{{ userQuery.data().totalSignals }}</strong>
          </div>
          <div class="stat-item">
            <i class="fas fa-percentage"></i>
            <span>{{ 'profile.winRate' | translate }}</span>
            <strong>{{ userQuery.data().winRate?.toFixed(1) }}%</strong>
          </div>
          <div class="stat-item">
            <i class="fas fa-scale-balanced"></i>
            <span>{{ 'profile.avgRiskReward' | translate }}</span>
            <strong>{{ userQuery.data().avgRiskReward?.toFixed(1) }}</strong>
          </div>
          <div class="stat-item">
            <i class="fas fa-star"></i>
            <span>{{ 'profile.score' | translate }}</span>
            <strong>{{ userQuery.data().score?.toFixed(1) }}</strong>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <div class="signals-container">
      <h2>{{ 'profile.signals' | translate }}</h2>
      @if (data()?.length > 0) {
        @for (signal of data(); track $index) {
          <app-signal-card [signal]="signal" [showScore]="true" />
        }
      } @else if (data() && data()?.length === 0) {
        <app-empty-state
          iconName="face-frown"
          [text]="'signal.emptyState' | translate"
        />
      }
      @if (signalsQuery.isLoading() || signalsQuery.isFetchingNextPage()) {
        <app-data-loading />
      } @else {
        @if (signalsQuery.hasNextPage()) {
          <button mat-button (click)="signalsQuery.fetchNextPage()">
            {{ 'app.loadMore' | translate }}
          </button>
        }
      }
    </div>
  </div>
}
